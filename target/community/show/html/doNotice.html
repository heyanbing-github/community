<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>后台模板</title>
		<link rel="stylesheet" href="../assets/css/amazeui.css" />
		<link rel="stylesheet" href="https://www.jq22.com/jquery/font-awesome.4.6.0.css">
		<link rel="stylesheet" href="../assets/css/core.css" />
		<link rel="stylesheet" href="../assets/css/menu.css" />
		
		<link rel="stylesheet" href="../assets/css/admin.css" />
		<link rel="stylesheet" href="../assets/css/page/typography.css" />
		<link rel="stylesheet" href="../assets/css/page/form.css" />

		<script src="/community/jq/commons.js"></script>
		<script src="/community/jq/jquery-1.11.2.js"></script>
	</head>
	<body>
		<!-- Begin page -->
		<header class="am-topbar am-topbar-fixed-top">		
			<div class="am-topbar-left am-hide-sm-only">
                <a href="index.html" class="logo"><span>Admin<span>to</span></span><i class="zmdi zmdi-layers"></i></a>
            </div>
	
			<div class="contain">
				<ul class="am-nav am-navbar-nav am-navbar-left">
					<br>
					<li><h4 class="page-title">公告管理</h4></li>
				</ul>
				

			</div>
		</header>
		<!-- end page -->
		
		
		<div class="admin">
			<!--<div class="am-g">-->
		<!-- ========== Left Sidebar Start ========== -->
		<!--<div class="left side-menu am-hide-sm-only am-u-md-1 am-padding-0">
			<div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 548px;">
				<div class="sidebar-inner slimscrollleft" style="overflow: hidden; width: auto; height: 548px;">-->
                  <!-- sidebar start -->
				  <div class="admin-sidebar am-offcanvas  am-padding-0" id="admin-offcanvas">
				    <div class="am-offcanvas-bar admin-offcanvas-bar">
				    	<!-- User -->
						<div class="user-box am-hide-sm-only">
	                        <div class="user-img">
	                            <img src="../assets/img/avatar-1.jpg" alt="user-img" title="Mat Helme" class="img-circle img-thumbnail img-responsive">
	                            <div class="user-status offline"><i class="am-icon-dot-circle-o" aria-hidden="true"></i></div>
	                        </div>
	                        <h5><a href="#">Mat Helme</a> </h5>
	                        <ul class="list-inline">
	                            <li>
	                                <a href="#">
	                                    <i class="fa fa-cog" aria-hidden="true"></i>
	                                </a>
	                            </li>
	
	                            <li>
	                                <a href="#" class="text-custom">
	                                    <i class="fa fa-cog" aria-hidden="true"></i>
	                                </a>
	                            </li>
	                        </ul>
	                    </div>
	                    <!-- End User -->
	            
						 <ul class="am-list admin-sidebar-list">
						    <li><a href="../index.html"><span class="am-icon-home"></span> 首页</a></li>
						    <li class="admin-parent">
						      <a class="am-cf" data-am-collapse="{target: '#collapse-nav1'}"><span class="am-icon-table"></span> 用户 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
						      <ul class="am-list am-collapse admin-sidebar-sub am-in" id="collapse-nav1">
						        <li><a href="userInfo.html" class="am-cf"> 个人信息</span></a></li>
						        <li><a href="managerText.html">管理帖子</a></li>
						 								<li><a href="managerFile.html">管理文件</a></li>
						 								<li><a href="buyGoods.html">购买的商品</a></li>
						      </ul>
						    </li>
						    <li class="admin-parent">
						      <a class="am-cf" data-am-collapse="{target: '#collapse-nav2'}"><i class="am-icon-line-chart" aria-hidden="true"></i> 管理员 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
						      <ul class="am-list am-collapse admin-sidebar-sub am-in" id="collapse-nav2">
						        <li><a href="adminInfo.html" class="am-cf"> 个人信息</span></a></li>
						        <li><a href="adminManagerUser.html" class="am-cf">用户管理</span></a></li>
						        <li><a href="adminManagerGoods.html" class="am-cf"> 商品管理</span></a></li>
								<li><a href="waitCheck.html" class="am-cf"> 待审核通知</span></a></li>
								<li><a href="doNotice.html" class="am-cf"> 公告管理</span></a></li>
						      </ul>
						    </li>
						    <li class="admin-parent">
						      <a class="am-cf" data-am-collapse="{target: '#collapse-nav5'}"><span class="am-icon-file"></span> 系统信息 <span class="am-icon-angle-right am-fr am-margin-right"></span></a>
						      <ul class="am-list am-collapse admin-sidebar-sub am-in" id="collapse-nav5">
						        <li><a href="userSpread.html">用户分布</a></li>
								<li><a href="versionNnumber.html">版本号</a></li>
								<li><a href="teamIntroduce.html">开发团队介绍</a></li>
						      </ul>
						    </li>
						  </ul>
				</div>
				  </div>
				  <!-- sidebar end -->
    
				<!--</div>
			</div>
		</div>-->
		<!-- ========== Left Sidebar end ========== -->
		
		
		
	<!--	<div class="am-g">-->
		<!-- ============================================================== -->
		<!-- Start right Content here -->
		<div class="content-page">
			<!-- Start content -->
			<div class="content">
				<div class="card-box">
					<!-- Row start -->
					<div class="am-g">
<!--						<div class="am-u-sm-12 am-u-md-6">-->
<!--				          <div class="am-btn-toolbar">-->
<!--				            <div class="am-btn-group am-btn-group-xs">-->
<!--				              <button type="button" class="am-btn am-btn-default"><span class="am-icon-trash-o"></span> 删除</button>-->
<!--				            </div>-->
<!--				          </div>-->
<!--				        </div>	-->
				        
						<div class="am-u-sm-12 am-u-md-3">
				          <div class="am-input-group am-input-group-sm">
				            <input id="searchText" type="text" class="am-form-field">
				          <span class="am-input-group-btn">
				            <button id="search" class="am-btn am-btn-default" type="button">搜索</button>
				          </span>
				          </div>
				        </div>
				      </div>
					  <!-- Row end -->
					  
					  <!-- Row start -->
					  	<div class="am-g">
        <div class="am-u-sm-12">
          <form class="am-form">
            <table class="am-table am-table-striped am-table-hover table-main">
              <thead>
              <tr>
                <th class="table-id">admin</th><th class="table-title">内容概要</th><th class="table-type"></th><th class="table-author am-hide-sm-only">发送时间</th><th class="table-set">操作</th><th></th>
              </tr>
              </thead>

              <tbody id="tbText">


              </tbody>
            </table>


            <div class="am-cf" id="pageam-cf">
<!--              共 15 条记录-->
              <div class="am-fr">
<!--                <ul class="am-pagination">-->
<!--                  <li class="am-disabled"><a href="#">«</a></li>-->
<!--                  <li class="am-active"><a href="#">1</a></li>-->
<!--                  <li><a href="#">2</a></li>-->
<!--                  <li><a href="#">3</a></li>-->
<!--                  <li><a href="#">4</a></li>-->
<!--                  <li><a href="#">5</a></li>-->
<!--                  <li><a href="#">»</a></li>-->
<!--                </ul>-->
              </div>
            </div>

            <hr/>
          </form>
        </div>

      </div>
					  <!-- Row end -->
					  
					</div>
				
				
				
				
				</div>
			

			</div>
		</div>
		<!-- end right Content here -->
		<!--</div>-->
		</div>
		</div>
		
		<!-- navbar -->
		<a href="admin-offcanvas" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}"><!--<i class="fa fa-bars" aria-hidden="true"></i>--></a>
		
		<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="../assets/js/amazeui.min.js"></script>
		<script type="text/javascript" src="../assets/js/app.js" ></script>
		<script type="text/javascript" src="../assets/js/blockUI.js" ></script>

		<script>
			var pageNow=1;
			var pageSize = 10;
			function showText(pageNow,pageSize){
				$.get("/community/admin/getNotice",{"pageNow":pageNow,"pageSize":pageSize},function (result) {
					if(result.state==0){//成功
						var pager = result.data;

						var textbody = $("#tbText");

						$("td").remove();
						$.each(pager.data,function (index,textDto) {
							var textTr = $("<tr></tr>");
							textbody.append(textTr);

							var textTdId = $("<td></td>");
							textTr.append(textTdId);
							textTdId.html(textDto.admin.username);

							var textTdTitile = $("<td></td>");
							textTr.append(textTdTitile);
							var textATitile = $("<a></a>");
							textTdTitile.append(textATitile);
							textATitile.attr("href","#");
							textATitile.html(textDto.content.substring(0,10)+"...");
							textATitile.click(function () {
								alert(textDto.content);
							});

							var textTdType = $("<td></td>");
							textTr.append(textTdType);
							textTdType.html(textDto.textType);

							var textTdFabulousNum = $("<td></td>");
							textTdFabulousNum.attr("class","am-hide-sm-only");
							textTr.append(textTdFabulousNum);
							textTdFabulousNum.html(textDto.sendTime);


							var textDo = $("<td></td>");
							textTr.append(textDo);
							var textDivM = $("<div></div>");
							textDivM.attr("class","am-btn-toolbar");
							textDo.append(textDivM);

							var textDivN = $("<div></div>");
							textDivN.attr("class","am-btn-group am-btn-group-xs");
							textDivM.append(textDivN);

							var textButton1 = $("<button></button>");
							textButton1.attr("class","am-btn am-btn-default am-btn-xs am-text-secondary");
							textDivN.append(textButton1);
							var textButton1Span = $("<span></span>");
							textButton1Span.attr("class","am-icon-pencil-square-o");
							textButton1.append(textButton1Span);
							textButton1.html("编辑");
							textButton1.click(function () {
								var c = prompt('请修改公告内容',textDto.content);
								var content = c;
								if (c==textDto.content || c==null){
									return;
								}else{
									$.get("/community/admin/updateNotice",{"nid":textDto.nid,"content":c,"mid":textDto.admin.mid},function (result) {
										if (result.state==0){
											alert(result.msg);
											showText(1,10);
										} else if (result.state==1) {
											alert(result.msg);
										}
									})
								}
							})

							var textButton2 = $("<button></button>");
							textButton2.attr("class","am-btn am-btn-default am-btn-xs am-text-danger am-hide-sm-only");
							textDivN.append(textButton2);
							var textButton2Span = $("<span></span>");
							textButton2Span.attr("class","am-icon-trash-o");
							textButton2.append(textButton2Span);
							textButton2.html("删除");

							textButton2.click(function () {
								$.get("/community/admin/deleteNotice",{"nid":textDto.nid},function (result) {
									if (result.state==0){
										alert(result.msg);
										showText(1,10);
									} else if (result.state==1) {
										alert(result.msg);
									}
								})
							})

						})


						var pageNumForm = $(".am-form");
						var pageNumMaxDiv = $("#pageam-cf");
						pageNumForm.append(pageNumMaxDiv);
						pageNumMaxDiv.text("共"+result.data.totalCount+"条记录");


						var pageNumDiv = $("<div></div>");
						pageNumDiv.attr("class","am-fr");
						pageNumMaxDiv.append(pageNumDiv);


						var pageUl = $("<ul class='am-pagination'></ul>");
						pageNumDiv.append(pageUl);

						//上一页页码
						var liLast = $("<li></li>");
						var liLastA = $("<a href='#'></a>");
						liLastA.html("«");
						liLast.append(liLastA);
						liLastA.on("click",{"pageNow":pageNow,"pageSize":pageSize},function (e) {
							var now = e.data.pageNow;
							var size= e.data.pageSize;
							if (pageNow>1){
								showText(now-1,size);
							}
						})
						pageUl.append(liLast);

						//123456页码
						for (var i=1;i<=pager.pageCount;i++) {
								var liNum = $("<li></li>");
								var liNumA = $("<a href='#'></a>");
							liNum.append(liNumA);
							pageUl.append(liNum);
							liNumA.html(i);
							liNumA.on("click", {"pageNow": i, "pageSize": pageSize}, function (e) {
								var now = e.data.pageNow;
								var size = e.data.pageSize;

								showText(now, size);
							})
							if (i==pageNow){
								liNum.attr("class","am-active");
							}
						}

						var liNext = $("<li></li>");
						var liNextA = $("<a href='#'></a>");
						liNextA.html("»");
						liNext.append(liNextA);
						liNextA.on("click",{"pageNow":pageNow,"pageSize":pageSize},function (e) {
							var now = e.data.pageNow;
							var size= e.data.pageSize;
							if (pageNow<pager.pageCount){
								showText(now+1,size);
							}

						})
						pageUl.append(liNext);

					}else if (result.state==1) {//没有发过帖子
						alert(result.msg);
					}else if (result.state==2){//未登录

					}
				})
			}

			showText(1,10);
			var search = $("#search");
			search.click(function () {
				var searchText = $("#searchText").val();
				$.get("/community/admin/getNoticeByKey",{"searchText":searchText,"pageNow":pageNow,"pageSize":pageSize},function (result) {
					if(result.state==0){//成功
						var pager = result.data;

						var textbody = $("#tbText");

						$("td").remove();
						$.each(pager.data,function (index,textDto) {
							var textTr = $("<tr></tr>");
							textbody.append(textTr);

							var textTdId = $("<td></td>");
							textTr.append(textTdId);
							textTdId.html(textDto.admin.username);

							var textTdTitile = $("<td></td>");
							textTr.append(textTdTitile);
							var textATitile = $("<a></a>");
							textTdTitile.append(textATitile);
							textATitile.attr("href","#");
							textATitile.html(textDto.content.substring(0,10)+"...");
							textATitile.click(function () {
								alert(textDto.content);
							});

							var textTdType = $("<td></td>");
							textTr.append(textTdType);
							textTdType.html(textDto.textType);

							var textTdFabulousNum = $("<td></td>");
							textTdFabulousNum.attr("class","am-hide-sm-only");
							textTr.append(textTdFabulousNum);
							textTdFabulousNum.html(textDto.sendTime);


							var textDo = $("<td></td>");
							textTr.append(textDo);
							var textDivM = $("<div></div>");
							textDivM.attr("class","am-btn-toolbar");
							textDo.append(textDivM);

							var textDivN = $("<div></div>");
							textDivN.attr("class","am-btn-group am-btn-group-xs");
							textDivM.append(textDivN);

							var textButton1 = $("<button></button>");
							textButton1.attr("class","am-btn am-btn-default am-btn-xs am-text-secondary");
							textDivN.append(textButton1);
							var textButton1Span = $("<span></span>");
							textButton1Span.attr("class","am-icon-pencil-square-o");
							textButton1.append(textButton1Span);
							textButton1.html("编辑");
							textButton1.click(function () {
								var c = prompt('请修改公告内容',textDto.content);
								var content = c;
								if (c==textDto.content || c==null){
									return;
								}else{
									$.get("/community/admin/updateNotice",{"nid":textDto.nid,"content":c,"mid":textDto.admin.mid},function (result) {
										if (result.state==0){
											alert(result.msg);
											showText(1,10);
										} else if (result.state==1) {
											alert(result.msg);
										}
									})
								}
							})

							var textButton2 = $("<button></button>");
							textButton2.attr("class","am-btn am-btn-default am-btn-xs am-text-danger am-hide-sm-only");
							textDivN.append(textButton2);
							var textButton2Span = $("<span></span>");
							textButton2Span.attr("class","am-icon-trash-o");
							textButton2.append(textButton2Span);
							textButton2.html("删除");

							textButton2.click(function () {
								$.get("/community/admin/deleteNotice",{"nid":textDto.nid},function (result) {
									if (result.state==0){
										alert(result.msg);
										showText(1,10);
									} else if (result.state==1) {
										alert(result.msg);
									}
								})
							})

						})


						var pageNumForm = $(".am-form");
						var pageNumMaxDiv = $("#pageam-cf");
						pageNumForm.append(pageNumMaxDiv);
						pageNumMaxDiv.text("共"+result.data.totalCount+"条记录");


						var pageNumDiv = $("<div></div>");
						pageNumDiv.attr("class","am-fr");
						pageNumMaxDiv.append(pageNumDiv);


						var pageUl = $("<ul class='am-pagination'></ul>");
						pageNumDiv.append(pageUl);

						//上一页页码
						var liLast = $("<li></li>");
						var liLastA = $("<a href='#'></a>");
						liLastA.html("«");
						liLast.append(liLastA);
						liLastA.on("click",{"pageNow":pageNow,"pageSize":pageSize},function (e) {
							var now = e.data.pageNow;
							var size= e.data.pageSize;
							if (pageNow>1){
								showText(now-1,size);
							}
						})
						pageUl.append(liLast);

						//123456页码
						for (var i=1;i<=pager.pageCount;i++) {
							var liNum = $("<li></li>");
							var liNumA = $("<a href='#'></a>");
							liNum.append(liNumA);
							pageUl.append(liNum);
							liNumA.html(i);
							liNumA.on("click", {"pageNow": i, "pageSize": pageSize}, function (e) {
								var now = e.data.pageNow;
								var size = e.data.pageSize;

								showText(now, size);
							})
							if (i==pageNow){
								liNum.attr("class","am-active");
							}
						}

						var liNext = $("<li></li>");
						var liNextA = $("<a href='#'></a>");
						liNextA.html("»");
						liNext.append(liNextA);
						liNextA.on("click",{"pageNow":pageNow,"pageSize":pageSize},function (e) {
							var now = e.data.pageNow;
							var size= e.data.pageSize;
							if (pageNow<pager.pageCount){
								showText(now+1,size);
							}

						})
						pageUl.append(liNext);

					}else if (result.state==1) {//没有发过帖子
						alert(result.msg);
					}else if (result.state==2){//未登录

					}
				})
			});

		</script>

	</body>
	
</html>
